{"is_source_file": true, "format": "Python", "description": "This is a test module for OAuth callback endpoint in a web application, containing unit tests that verify correct handling of different callback scenarios including missing parameters, invalid states, successful token exchanges, upstream errors, and failure cases.", "external_files": ["app/main.py", "app/__init__.py", "httpx"], "external_methods": ["app.main._state_store", "app.main._token_cache", "httpx.Client.post"], "published": [], "classes": [{"name": "types.SimpleNamespace", "description": "A simple class for creating objects with arbitrary attributes, used here to mock HTTP responses."}], "methods": [{"name": "_insert_valid_state()", "description": "Helper function to insert a valid OAuth state token into the _state_store for testing.", "scope": "", "scopeKind": ""}, {"name": "test_callback_missing_params_returns_400_html", "description": "Tests that missing parameters in the callback return a 400 error with appropriate message."}, {"name": "test_callback_invalid_state_returns_400(client)", "description": "Tests that an invalid state token results in a 400 error response.", "scope": "", "scopeKind": ""}, {"name": "test_callback_success_json_sets_token_cache_and_returns_safe_fields(client, monkeypatch)", "description": "Verifies successful token exchange, cache update, and response content when correct parameters are provided.", "scope": "", "scopeKind": ""}, {"name": "test_callback_upstream_error_returns_502_html(client, monkeypatch)", "description": "Ensures that upstream errors during token exchange return a 502 error.", "scope": "", "scopeKind": ""}, {"name": "test_callback_token_exchange_failure_propagates_status_and_detail_json(client, monkeypatch)", "description": "Checks that a failed token exchange returns the appropriate error status and JSON response.", "scope": "", "scopeKind": ""}, {"name": "fake_post(self, url, json=None, headers=None)", "scope": "test_callback_upstream_error_returns_502_html", "scopeKind": "function", "description": "unavailable"}, {"name": "test_callback_missing_params_returns_400_html_by_default(client)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["app.main._state_store.__setitem__", "app.main._token_cache.get", "httpx.Client.post", "client.get"], "search-terms": ["OAuth callback test", "token exchange mock", "state validation", "pytest", "FastAPI test client", "mock httpx", "token cache"], "state": 2, "file_id": 8, "knowledge_revision": 39, "git_revision": "", "ctags": [{"_type": "tag", "name": "E", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^        class E(Exception):$/", "file": true, "language": "Python", "kind": "class", "scope": "test_callback_upstream_error_returns_502_html.fake_post", "scopeKind": "function"}, {"_type": "tag", "name": "_insert_valid_state", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^def _insert_valid_state():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "fake_post", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^    def fake_post(self, url, json=None, headers=None):$/", "file": true, "language": "Python", "kind": "function", "signature": "(self, url, json=None, headers=None)", "scope": "test_callback_success_json_sets_token_cache_and_returns_safe_fields", "scopeKind": "function"}, {"_type": "tag", "name": "fake_post", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^    def fake_post(self, url, json=None, headers=None):$/", "file": true, "language": "Python", "kind": "function", "signature": "(self, url, json=None, headers=None)", "scope": "test_callback_token_exchange_failure_propagates_status_and_detail_json", "scopeKind": "function"}, {"_type": "tag", "name": "fake_post", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^    def fake_post(self, url, json=None, headers=None):$/", "file": true, "language": "Python", "kind": "function", "signature": "(self, url, json=None, headers=None)", "scope": "test_callback_upstream_error_returns_502_html", "scopeKind": "function"}, {"_type": "tag", "name": "mainmod", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^    from app import main as mainmod$/", "file": true, "language": "Python", "kind": "unknown", "scope": "test_callback_success_json_sets_token_cache_and_returns_safe_fields", "scopeKind": "function", "nameref": "unknown:main"}, {"_type": "tag", "name": "mainmod", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^    from app import main as mainmod$/", "file": true, "language": "Python", "kind": "unknown", "scope": "test_callback_token_exchange_failure_propagates_status_and_detail_json", "scopeKind": "function", "nameref": "unknown:main"}, {"_type": "tag", "name": "mainmod", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^    from app import main as mainmod$/", "file": true, "language": "Python", "kind": "unknown", "scope": "test_callback_upstream_error_returns_502_html", "scopeKind": "function", "nameref": "unknown:main"}, {"_type": "tag", "name": "test_callback_invalid_state_returns_400", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^def test_callback_invalid_state_returns_400(client):$/", "language": "Python", "kind": "function", "signature": "(client)"}, {"_type": "tag", "name": "test_callback_missing_params_returns_400_html_by_default", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^def test_callback_missing_params_returns_400_html_by_default(client):$/", "language": "Python", "kind": "function", "signature": "(client)"}, {"_type": "tag", "name": "test_callback_success_json_sets_token_cache_and_returns_safe_fields", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^def test_callback_success_json_sets_token_cache_and_returns_safe_fields(client, monkeypatch):$/", "language": "Python", "kind": "function", "signature": "(client, monkeypatch)"}, {"_type": "tag", "name": "test_callback_token_exchange_failure_propagates_status_and_detail_json", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^def test_callback_token_exchange_failure_propagates_status_and_detail_json(client, monkeypatch):$/", "language": "Python", "kind": "function", "signature": "(client, monkeypatch)"}, {"_type": "tag", "name": "test_callback_upstream_error_returns_502_html", "path": "/home/kavia/workspace/code-generation/unified-jira-confluence-interface-146751-146761/integration_backend/tests/test_oauth_callback.py", "pattern": "/^def test_callback_upstream_error_returns_502_html(client, monkeypatch):$/", "language": "Python", "kind": "function", "signature": "(client, monkeypatch)"}], "hash": "eebff3d3d8b3e2dca1e48f96f54b5c5d", "format-version": 4, "code-base-name": "integration_backend", "filename": "integration_backend/tests/test_oauth_callback.py", "revision_history": [{"39": ""}]}